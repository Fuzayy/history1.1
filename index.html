<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-M">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Um Presente Especial</title>
    <style>
        /*
         * 1. Estrutura e Estilo Base (CSS)
         */

        :root {
            /* Cores */
            --color-background: #000;
            --color-primary: #dc143c; /* Carmesim (Destaque Principal - Originalmente bot√µes e cora√ß√µes) */
            --color-secondary: #ffb6c1; /* Rosa Claro (Destaque Secund√°rio) */
            --color-text: #f0f0f0;
            --color-shadow-primary: rgba(220, 20, 60, 0.8);
            --color-shadow-secondary: rgba(255, 182, 193, 0.8);
            --color-gold: #ffd700; /* Dourado para as "estrelas" */
            --color-green-palmeiras: #00FF00; /* Verde limao do Palmeiras*/
            --color-shadow-green: rgba(0, 100, 0, 0.8); /* Sombra verde */
            
            /* NOVAS CORES para os bot√µes finais */
            --color-sim-btn: var(--color-green-palmeiras); /* Bot√£o SIM come√ßa verde */
            --color-nao-btn: var(--color-primary); /* Bot√£o N√ÉO come√ßa vermelho */
            --color-nao-fugitivo: #666; /* Cor CINZA para o bot√£o N√ÉO fugitivo */
            --color-shadow-nao-fugitivo: rgba(102, 102, 102, 0.8); /* Sombra CINZA */

            --current-heart-color: var(--color-primary); /* Vari√°vel CSS para a cor do cora√ß√£o */
        }

        /* Reset B√°sico */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden; 
            position: relative;
        }

        /* Efeito de Brilho (Glow Effect) para T√≠tulos e Bot√µes */
        h1, h2, .glow-text {
            text-shadow: 0 0 5px var(--color-shadow-primary), 0 0 10px var(--color-primary), 0 0 15px var(--color-primary);
        }

        /* ---------------------------------------------------- */
        /* Sistema de Part√≠culas Flutuantes (.heart-bg) */
        /* ---------------------------------------------------- */
        #heart-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; 
            overflow: hidden;
        }

        .particle {
            position: absolute;
            bottom: 0;
            display: block;
            opacity: 0;
            animation: float-soft linear infinite;
            text-shadow: 0 0 5px currentColor, 0 0 15px currentColor;
        }

        .particle.heart {
            color: var(--current-heart-color); 
            font-size: 1.5rem; 
        }

        .particle.star {
            color: var(--color-gold);
            font-size: 1rem; 
        }
        
        @keyframes float-soft {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            80% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* ---------------------------------------------------- */
        /* Estilos Comuns de Layout */
        /* ---------------------------------------------------- */
        .screen {
            width: 90%;
            max-width: 600px;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh; 
            position: relative;
            z-index: 10;
        }

        /* Bot√£o Padr√£o */
        .btn {
            background-color: var(--color-primary); 
            color: var(--color-text);
            border: none;
            padding: 15px 15px; 
            margin-top: 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px var(--color-shadow-primary);
            /* LARGURA REDUZIDA E CENTRALIZADA */
            width: 35%; 
            display: block; 
            margin-left: auto; 
            margin-right: auto; 
        }

        .btn:hover {
            background-color: var(--color-secondary);
            color: var(--color-background);
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--color-shadow-secondary), 0 0 25px var(--color-secondary);
        }
        
        /* NOVO: Estilo para o bot√£o √öLTIMO PASSO */
        #final-whatsapp-btn {
            /* Copiando a cor principal, mas usando 100% de largura no container final */
            background-color: var(--color-primary);
            width: 60%; /* Um pouco mais largo que os bot√µes iniciais, para destaque */
            max-width: 300px;
            margin-top: 30px; /* Mais espa√ßamento para n√£o ficar colado na mensagem */
            box-shadow: 0 0 15px var(--color-shadow-primary);
            font-size: 1.3rem;
            display: none; /* Come√ßa escondido */
        }
        #final-whatsapp-btn:hover {
             background-color: var(--color-secondary);
             box-shadow: 0 0 20px var(--color-shadow-secondary), 0 0 30px var(--color-secondary);
        }


        /* ---------------------------------------------------- */
        /* A. Tela de In√≠cio (#start-screen) */
        /* ---------------------------------------------------- */
        #start-screen h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--color-secondary);
        }

        #start-screen p {
            font-size: 1.1rem;
            margin-bottom: 30px;
        }


        /* ---------------------------------------------------- */
        /* B. Carrossel de Fotos e Textos (.container) */
        /* ---------------------------------------------------- */
        .carousel-container {
            display: none; 
            width: 100%;
            max-width: 900px;
            position: relative;
            z-index: 10;
            perspective: 1000px; 
            /* MODIFICADO: Aumentei o padding-bottom para dar espa√ßo ao indicador */
            padding-bottom: 70px; 
            /* Importante: Definir uma altura m√≠nima para o cont√™iner base */
            min-height: 60vh; 
        }

        .carousel-item, .text-slide {
            display: none; 
            text-align: center;
            position: absolute; /* Mantenha sempre absoluto */
            width: 100%;
            left: 0;
            /* REMOVIDO: Padding aqui, a sombra est√° na imagem */
            /* padding: 10px; */ 
            backface-visibility: hidden; 
            
            /* CENTRALIZA√á√ÉO PERMANENTE (Verticalmente) */
            top: 50%;
            /* Inicializa o transform com a centraliza√ß√£o vertical */
            transform: translateY(-50%); 
            
            /* O slide deve come√ßar escondido (opacity 0) e s√≥ a anima√ß√£o ou a classe .active-slide o revela */
            opacity: 0;
        }

        .active-slide {
            display: block; 
            opacity: 1;
            z-index: 2; /* Slide ativo deve estar em cima do que est√° esperando */
            
            /* O slide ativo √© apenas a posi√ß√£o final centralizada */
            position: absolute; 
            transform: translateY(-50%) translateX(0) rotate(0deg); /* Posi√ß√£o centralizada final */
        }

        .carousel-item img {
            /* ** CHAVE DA CORRE√á√ÉO: Usar max-width e max-height com width: auto ** */
            max-width: 85%;    /* Limita a largura m√°xima da imagem (e da sombra) */
            max-height: 60vh;  /* Limita a altura m√°xima da imagem (e da sombra) */
            
            /* Garante que a imagem use a largura e altura intr√≠nseca, respeitando o max-width/height */
            width: auto;       
            height: auto;      
            
            object-fit: contain; /* Garante que a imagem se encaixe sem cortar */
            
            /* ** CHAVE DA BORDA CORRETA: border-radius E box-shadow na IMAGEM ** */
            border-radius: 15px; 
            box-shadow: 0 0 8px 3px rgba(220, 20, 60, 0.6); /* Sombra principal na imagem (ajustada para ser mais "borda") */
            
            border: none; 
            padding: 0; 
            background-color: transparent; 
            transition: none; 

            /* SEM FILTRO DE SOMBRA, APENAS BOX-SHADOW */
            filter: none; 
        }
        
        /* Estilo espec√≠fico para a foto 7 */
        .carousel-item:nth-child(7) img {
            /* Aplicamos a box-shadow verde diretamente na imagem 7 */
            box-shadow: 0 0 8px 3px rgba(0, 255, 0, 0.6); 
        }
        
        /* Garantir que as outras tenham a sombra vermelha quando ativas (j√° coberto pelo .carousel-item img) */


        .caption {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-style: italic;
            font-size: 1.1rem;
            min-height: 50px; 
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .text-slide h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--color-secondary);
        }

        .text-slide p {
            font-size: 1.3rem;
            line-height: 1.6;
        }
        
        /* ---------------------------------------------------- */
        /* ANIMA√á√ïES "SLIDE LATERAL" COM ROTA√á√ÉO (Efeito Cartinha) */
        /* ---------------------------------------------------- */
        
        /* O slide que ENTRA */
        .slide-in-right { 
            animation: slide-in-right 0.8s ease-out forwards;
            z-index: 3; 
            display: block !important;
        }

        .slide-in-left { 
            animation: slide-in-left 0.8s ease-out forwards;
            z-index: 3; 
            display: block !important;
        }

        /* O slide que SAI */
        .slide-out-left { 
            animation: slide-out-left 0.8s ease-in forwards;
            z-index: 4; 
            display: block !important;
        }
        
        .slide-out-right { 
            animation: slide-out-right 0.8s ease-in forwards;
            z-index: 4; 
            display: block !important;
        }

        @keyframes slide-in-right {
            from {
                /* Gira ligeiramente ao entrar pela direita */
                transform: translateY(-50%) translateX(100%) rotate(5deg); 
                opacity: 0.5;
            }
            to {
                transform: translateY(-50%) translateX(0) rotate(0deg); 
                opacity: 1;
            }
        }
        
        @keyframes slide-in-left {
            from {
                /* Gira ligeiramente ao entrar pela esquerda */
                transform: translateY(-50%) translateX(-100%) rotate(-5deg); 
                opacity: 0.5;
            }
            to {
                transform: translateY(-50%) translateX(0) rotate(0deg); 
                opacity: 1;
            }
        }

        @keyframes slide-out-left {
            from {
                transform: translateY(-50%) translateX(0) rotate(0deg); 
                opacity: 1;
            }
            to {
                /* Gira ligeiramente ao sair pela esquerda */
                transform: translateY(-50%) translateX(-100%) rotate(-5deg); 
                opacity: 0.5;
            }
        }

        @keyframes slide-out-right {
            from {
                transform: translateY(-50%) translateX(0) rotate(0deg); 
                opacity: 1;
            }
            to {
                /* Gira ligeiramente ao sair pela direita */
                transform: translateY(-50%) translateX(100%) rotate(5deg); 
                opacity: 0.5;
            }
        }


        /* Indicador de Swipe */
        #swipe-indicator {
            position: absolute;
            /* Deslocado para baixo */
            bottom: -70px; 
            left: 50%;
            transform: translateX(-50%);
            color: var(--color-secondary);
            font-size: 1.1rem;
            opacity: 0.8;
            user-select: none;
            cursor: grab;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: pulse-swipe 1.5s infinite;
            z-index: 10;
        }
        
        @keyframes pulse-swipe {
            0% { transform: translateX(-50%) scale(1); opacity: 0.8; }
            50% { transform: translateX(-50%) scale(1.05); opacity: 1; }
            100% { transform: translateX(-50%) scale(1); opacity: 0.8; }
        }

        /* ---------------------------------------------------- */
        /* C. Tela Final Interativa (#final) */
        /* ---------------------------------------------------- */
        #final {
            display: none; 
            flex-direction: column; 
            align-items: center; 
            gap: 20px;
            width: 100%; 
        }
        
        .final-buttons-wrapper {
            position: relative; 
            display: flex;
            justify-content: center; /* Centraliza o bloco de bot√µes */
            gap: 20px; /* Garante o espa√ßo entre os bot√µes */
            width: 100%;
            max-width: 450px; 
            min-height: 100px; 
            margin-top: 10px; 
            padding: 20px; 
        }
        
        /* Estilos espec√≠ficos para os bot√µes SIM e N√ÉO na tela final */
        .final-buttons-wrapper #sim-btn,
        .final-buttons-wrapper #nao-btn {
            margin-top: 0; 
            display: flex; 
            align-items: center;
            justify-content: center;
            
            width: 150px; 
            max-width: none; 
            
            position: static !important; /* Anula o position absolute da fuga do N√ÉO */
            
            /* SOBRESCREVE A LARGURA DO .btn GERAL E REMOVE A CENTRALIZA√á√ÉO DESNECESS√ÅRIA */
            margin-left: initial;
            margin-right: initial;
        }

        #final-question {
            font-size: 1.8rem;
            margin-bottom: 30px; 
            color: var(--color-secondary);
            text-shadow: 0 0 5px var(--color-shadow-secondary), 0 0 10px var(--color-secondary);
            width: 100%;
        }
        
        /* NOVO: Garante que o SIM esteja sempre acima do NAO (que usa absolute na fuga) */
        #sim-btn {
            z-index: 10; /* Valor alto para garantir prioridade de clique */
            background-color: var(--color-sim-btn); 
            box-shadow: 0 0 10px var(--color-shadow-green);
        }
        #sim-btn:hover {
            background-color: var(--color-green-palmeiras); 
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--color-shadow-green), 0 0 25px var(--color-green-palmeiras);
        }

        #nao-btn {
            background-color: var(--color-nao-btn); 
            box-shadow: 0 0 10px var(--color-shadow-primary);
            transition: all 0.1s ease-out; 
        }
        #nao-btn:hover {
            background-color: var(--color-primary); 
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--color-shadow-primary), 0 0 25px var(--color-primary);
        }

        /* Estilo para o bot√£o NAO quando ele est√° fugindo */
        .nao-fugitivo-style {
            background-color: var(--color-nao-fugitivo) !important; 
            box-shadow: 0 0 10px var(--color-shadow-nao-fugitivo) !important;
            color: var(--color-text) !important; 
        }


        /* Classe para mudar o tema para verde (da foto 7) */
        body.green-theme .btn { 
            background-color: var(--color-green-palmeiras);
            box-shadow: 0 0 10px var(--color-shadow-green);
        }

        body.green-theme .btn:hover {
            background-color: var(--color-primary); 
            box-shadow: 0 0 15px var(--color-shadow-primary), 0 0 25px var(--color-primary);
        }

        body.green-theme h1, body.green-theme h2, body.green-theme .glow-text {
            text-shadow: 0 0 5px var(--color-shadow-green), 0 0 10px var(--color-green-palmeiras), 0 0 15px var(--color-green-palmeiras);
        }


        #sim-final-message {
            display: none;
            font-size: 3rem;
            color: var(--color-secondary);
            text-shadow: 
                0 0 10px var(--color-shadow-secondary), 
                0 0 20px var(--color-secondary), 
                0 0 30px var(--color-secondary),
                0 0 40px var(--color-primary);
            animation: pulse-glow 1.5s infinite alternate;
        }
        
        @keyframes pulse-glow {
            from { text-shadow: 0 0 10px var(--color-secondary); }
            to { text-shadow: 0 0 20px var(--color-secondary), 0 0 30px var(--color-primary); }
        }

        /* Media Query para Responsividade */
        @media (max-width: 768px) {
            #start-screen h1 {
                font-size: 2rem;
            }

            .carousel-item img {
                max-height: 50vh; /* Ajustado para telas menores tamb√©m */
                max-width: 95%; /* Ajustado para telas menores tamb√©m */
            }

            #final-question {
                font-size: 1.5rem;
            }
            
            .final-buttons-wrapper {
                 max-width: 90%;
            }
            
            .final-buttons-wrapper #sim-btn,
            .final-buttons-wrapper #nao-btn {
                 width: 120px; 
            }
            
            #sim-final-message {
                font-size: 2rem;
            }
            
            /* Ajuste para o bot√£o INICIAR (e outros bot√µes .btn) em telas pequenas */
            .btn {
                 width: 50%; /* Mantido em 50% para telas pequenas para n√£o ficar min√∫sculo */
            }
            
            #final-whatsapp-btn {
                 width: 80%;
            }
        }
    </style>
</head>
<body>
    <div id="heart-bg"></div>
    
    <audio id="story-audio" loop preload="auto">
        <source src="media/Those_Eyes.mp3" type="audio/mp3">
        Seu navegador n√£o suporta o elemento de √°udio.
    </audio>

    <div id="start-screen" class="screen">
        <h1 class="glow-text">Um presente para voc√™...</h1>
        <p>Preparei isso com muito amor, para voc√™ nunca se esquecer do qu√£o lindo foi tudo o que vivemos e o quanto fui feliz ao seu lado.<br>Ativa o som!üîä.</p>
        <button id="start-button" class="btn">INICIAR</button>
    </div>

    <div class="carousel-container">
        <div class="carousel-item active-slide">
            <img src="media/foto1.jpg" alt="Foto 1">
            <p class="caption">Nosso primeiro encontro ‚ù§Ô∏è</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto2.jpg" alt="Foto 2">
            <p class="caption">Nosso momento no parque üå∏</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto3.jpg" alt="Foto 3">
            <p class="caption">O dia em que minha m√£e viu n√≥s dois juntos ‚ù§Ô∏è</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto4.jpg" alt="Foto 4">
            <p class="caption">Os bilhetes dos quais amo tanto üñãÔ∏è‚ù§Ô∏è</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto5.jpg" alt="Foto 5">
            <p class="caption">Primeiro Almo√ßo especial (hmmm Ravioli)üçù</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto6.jpg" alt="Foto 6">
            <p class="caption">O primeiro fim de semana fora de casa üíØüíãü´£</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto7.jpg" alt="Foto 7">
            <p class="caption">Nosso lado VERD√ÉOüíöüê∑</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto8.jpg" alt="Foto 8">
            <p class="caption">O dia em que te entreguei um dos itens mais importantes da nossa hist√≥riaüíçüåπ‚ù§Ô∏è</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto9.jpg" alt="Foto 9">
            <p class="caption">N√£o importa o lugar, quando estamos juntos, √© sempre lindo‚ù§Ô∏èü•Å</p>
        </div>
        <div class="carousel-item">
            <img src="media/foto10.jpg" alt="Foto 10">
            <p class="caption">A mulher que trouxe paz e mais felicidade em cada dia da minha vidaü•π‚ù§Ô∏è</p>
        </div>

        <div class="text-slide">
            <h2 class="glow-text">O In√≠cio</h2>
            <p>Seu jeito me encantou desde o primeiro instante. Voc√™ √© a pessoa que eu n√£o sabia que procurava...</p>
        </div>
        <div class="text-slide">
            <h2 class="glow-text">Nossa Jornada</h2>
            <p>Cada dia que passei ao seu lado, foi uma nova raz√£o para agradecer dia ap√≥s dia por ter voc√™...</p>
        </div>
        <div class="text-slide">
            <h2 class="glow-text">Meu Amor</h2>
            <p>O que eu sinto por voc√™ e a nossa hist√≥ria, √© muito grande para ser contada em apenas 10 fotos</p>
        </div>
        <div class="text-slide">
            <h2 class="glow-text">Meu Cora√ß√£o</h2>
            <p>Eu n√£o precisei de muito para te amar, o seu sorriso e o seu jeitinho me conquistaram no nosso primeiro encontro...</p>
        
        </div>
        <div class="text-slide">
            <h2 class="glow-text">Nossa Data</h2>
            <p>Todas as noites eu penso no nosso 15.11.2023, lembra?<p/>
        </div>
        
        <div class="text-slide">
            <h2 class="glow-text">Hora de uma Brincadeira</h2>
            
        </div>
	<div class="text-slide">
            <h2 class="glow-text">E se...</h2>
        </div>

        <div id="swipe-indicator">
            <span>&#10094;</span> ARRASTE <span>&#10095;</span>
        </div>
    </div>

    <div id="final" class="screen">
        <h2 id="final-question">A gente desse um beijinho?<br>S√≥ pra ver como vai ser!üòç"</h2>
        
        <div class="final-buttons-wrapper">
            <button id="sim-btn" class="btn">SIM! ‚ù§Ô∏è</button>
            <button id="nao-btn" class="btn">N√ÉO</button>
        </div>

        <h1 id="sim-final-message">
            Obrigado por tudo e... <br> Eu continuo te amando... <br> Dia ap√≥s dia...
        </h1>
        
        <button id="final-whatsapp-btn" class="btn">Eu estou aqui pra voc√™üí¨</button>
    </div>

    <script>
        const START_SCREEN = document.getElementById('start-screen');
        const CAROUSEL_CONTAINER = document.querySelector('.carousel-container');
        const FINAL_SCREEN = document.getElementById('final');
        const START_BUTTON = document.getElementById('start-button');
        const AUDIO = document.getElementById('story-audio');
        const CAROUSEL_ITEMS = document.querySelectorAll('.carousel-item, .text-slide');
        const SIM_BUTTON = document.getElementById('sim-btn');
        const NAO_BUTTON = document.getElementById('nao-btn');
        const SIM_FINAL_MESSAGE = document.getElementById('sim-final-message');
        const FINAL_WHATSAPP_BTN = document.getElementById('final-whatsapp-btn');
        const HEART_BG = document.getElementById('heart-bg');
        const SWIPE_INDICATOR = document.getElementById('swipe-indicator');
        const FINAL_BUTTONS_WRAPPER = document.querySelector('.final-buttons-wrapper'); 

        // Definindo o index inicial para o primeiro slide.
        let currentIndex = 0; 
        
        const totalSlides = CAROUSEL_ITEMS.length;
        const FINAL_SCREEN_INDEX = totalSlides;
        let naoButtonCanMove = true;
        let particleInterval;
        const initialNaoText = NAO_BUTTON.textContent; 
        
        let isFugindo = false; 

        let touchstartX = 0;
        let touchendX = 0;
        const SWIPE_THRESHOLD = 50; 
        
        let isDragging = false; 

        /*
         * Fun√ß√µes de Controle de Fluxo
         */
        
        START_BUTTON.addEventListener('click', () => {
            START_SCREEN.style.display = 'none';
            CAROUSEL_CONTAINER.style.display = 'block';
            
            AUDIO.play().catch(e => console.log("√Åudio n√£o p√¥de ser reproduzido automaticamente.", e));
            
            // O primeiro item j√° est√° com 'active-slide' e deve ser o √∫nico vis√≠vel
            showItem(currentIndex); // Chamada para atualizar o indicador de swipe (e tema, se necess√°rio)
        });

        function showItem(index) {
             // Fun√ß√£o auxiliar que s√≥ atualiza o tema e o indicador
             updateTheme(index);
        }

        function updateTheme(index) {
             const body = document.body;
             const root = document.documentElement; 

             if (index === 6) { 
                 root.style.setProperty('--current-heart-color', 'var(--color-green-palmeiras)');
                 body.classList.add('green-theme'); 
             } else {
                 root.style.setProperty('--current-heart-color', 'var(--color-primary)');
                 body.classList.remove('green-theme');
             }

             // CORRE√á√ÉO: Garante que "E se..." (√∫ltimo slide do array) tenha setas duplas.
             if (index === 0) {
                 // Primeiro slide: s√≥ avan√ßa
                 SWIPE_INDICATOR.innerHTML = 'ARRASTE &#10095;'; 
             } else {
                 // Todos os slides restantes (incluindo o "E se...")
                  SWIPE_INDICATOR.innerHTML = '&#10094; ARRASTE &#10095;';
             }
        }
        
        // C√ìDIGO DA TRANSI√á√ÉO CORRIGIDO
        function changeSlide(n) { // 'n' ser√° 1 para avan√ßar, -1 para retroceder
            const nextIndex = currentIndex + n;
            
            if (nextIndex < 0) { // N√£o permite voltar antes do primeiro slide
                return;
            } else if (nextIndex >= totalSlides) { // Vai para a tela final
                showFinalScreen();
                return;
            }
            
            const currentItem = CAROUSEL_ITEMS[currentIndex];
            const nextItem = CAROUSEL_ITEMS[nextIndex];

            // 1. Limpeza de todas as classes de anima√ß√£o e mant√©m todos os slides vis√≠veis 
            // no DOM, mas a opacidade 0 do estilo base os esconde.
            CAROUSEL_ITEMS.forEach(item => {
                item.classList.remove('active-slide', 'slide-in-right', 'slide-in-left', 'slide-out-left', 'slide-out-right');
                item.style.display = 'block'; // Mantenha no DOM
            });
            
            // 2. Determina as classes de anima√ß√£o com base na dire√ß√£o (n)
            let currentOutClass, nextInClass;

            if (n > 0) { // Avan√ßando (pr√≥ximo slide)
                currentOutClass = 'slide-out-left'; // O atual sai para a esquerda
                nextInClass = 'slide-in-right';    // O pr√≥ximo entra pela direita
            } else { // Retrocedendo (slide anterior)
                currentOutClass = 'slide-out-right'; // O atual sai para a direita
                nextInClass = 'slide-in-left';      // O pr√≥ximo entra pela esquerda
            }

            // 3. Configura o pr√≥ximo item para a anima√ß√£o de entrada
            nextItem.classList.add(nextInClass);

            // 4. Configura o item atual para a anima√ß√£o de sa√≠da
            currentItem.classList.add(currentOutClass); 
            
            // 5. Atualiza o √≠ndice
            currentIndex = nextIndex;
            
            // 6. Usa o 'animationend' no slide que est√° ENTRANDO para limpar e finalizar.
            nextItem.addEventListener('animationend', function handler() {
                // O slide que entrou √© o novo 'active-slide'
                nextItem.classList.remove(nextInClass); 
                nextItem.classList.add('active-slide');
                
                // O slide que saiu deve ser escondido
                currentItem.style.display = 'none';
                currentItem.classList.remove(currentOutClass); 
                
                nextItem.removeEventListener('animationend', handler); 
            }, { once: true }); 
            
            // 7. Atualiza o tema e o indicador de swipe
            updateTheme(currentIndex);
        }
        // FIM DO C√ìDIGO DA TRANSI√á√ÉO CORRIGIDO

        function showFinalScreen() {
            CAROUSEL_CONTAINER.style.display = 'none';
            FINAL_SCREEN.style.display = 'flex';
            
            SWIPE_INDICATOR.style.display = 'none';
            FINAL_WHATSAPP_BTN.style.display = 'none'; // Garante que o bot√£o final comece escondido

            document.documentElement.style.setProperty('--current-heart-color', 'var(--color-primary)');
            document.body.classList.remove('green-theme');
            
            // Volta o bot√£o N√ÉO para a posi√ß√£o inicial Flexbox no final da hist√≥ria
            NAO_BUTTON.style.position = 'static';
            NAO_BUTTON.style.transform = 'none';
            NAO_BUTTON.textContent = initialNaoText;
            NAO_BUTTON.classList.remove('nao-fugitivo-style');
        }

        /*
         * L√≥gica de Swipe/Arrastar
         */
        
        CAROUSEL_CONTAINER.addEventListener('touchstart', e => {
            e.preventDefault(); 
            touchstartX = e.changedTouches[0].screenX;
            isDragging = true;
        });

        CAROUSEL_CONTAINER.addEventListener('mousedown', e => {
            e.preventDefault(); 
            touchstartX = e.screenX;
            isDragging = true;
        });
        
        CAROUSEL_CONTAINER.addEventListener('mousemove', e => {
            if (isDragging) {
                touchendX = e.screenX;
            }
        });

        CAROUSEL_CONTAINER.addEventListener('touchend', e => {
            touchendX = e.changedTouches[0].screenX;
            isDragging = false;
            handleGesture();
        });
        
        CAROUSEL_CONTAINER.addEventListener('mouseup', e => {
            if (isDragging) {
                touchendX = e.screenX;
                handleGesture();
            }
            isDragging = false;
        });

        function handleGesture() {
            const diff = touchstartX - touchendX;
            
            if (Math.abs(diff) < SWIPE_THRESHOLD) return; 

            // Se a diferen√ßa for positiva (arrastando da direita para a esquerda)
            if (diff > 0) {
                changeSlide(1);
            } else {
                // Se a diferen√ßa for negativa (arrastando da esquerda para a direita)
                changeSlide(-1);
            }
            
            touchstartX = 0;
            touchendX = 0;
        }


        /*
         * Fun√ß√µes Especiais - Part√≠culas e Bot√£o "N√£o"
         */
        
        function createParticle() {
            if (!document.hidden) {
                const particle = document.createElement('span');
                const isHeart = Math.random() > 0.4; 
                
                particle.classList.add('particle', isHeart ? 'heart' : 'star');
                particle.innerHTML = isHeart ? '&#10084;' : '&#10029;';

                const size = Math.random() * 20 + 10;
                const duration = Math.random() * 8 + 5;

                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.opacity = Math.random() * 0.5 + 0.3;
                particle.style.animationDuration = `${duration}s`;
                particle.style.animationDelay = `${-Math.random() * duration}s`;

                HEART_BG.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, duration * 1000);
            }
        }

        function startParticleAnimation() {
            particleInterval = setInterval(createParticle, 200); 
            for (let i = 0; i < 50; i++) {
                createParticle();
            }
        }

        function moveNaoButton() {
            if (!naoButtonCanMove || isFugindo) return;

            isFugindo = true; 
            
            const containerRect = FINAL_BUTTONS_WRAPPER.getBoundingClientRect();
            
            // Define o range de fuga. Usamos 0.9 para dar uma margem de seguran√ßa.
            const escapeRangeX = containerRect.width * 0.9;
            const escapeRangeY = containerRect.height * 0.9;

            // Calcula um novo deslocamento aleat√≥rio.
            const newTranslateX = (Math.random() - 0.5) * escapeRangeX;
            const newTranslateY = (Math.random() - 0.5) * escapeRangeY;
            
            NAO_BUTTON.style.position = 'absolute';
            NAO_BUTTON.style.left = '50%';
            NAO_BUTTON.style.top = '50%';
            
            // O translate usa as coordenadas calculadas, mas aplica o -50% -50% no CSS para manter o bot√£o centralizado no ponto
            NAO_BUTTON.style.transform = `translate(calc(-50% + ${newTranslateX}px), calc(-50% + ${newTranslateY}px))`;
            NAO_BUTTON.style.opacity = '1'; 
            NAO_BUTTON.style.pointerEvents = 'auto'; 

            NAO_BUTTON.textContent = "√îL√â√â√â√â!";
            NAO_BUTTON.classList.add('nao-fugitivo-style');
            
            setTimeout(() => {
                isFugindo = false;
            }, 100); 
        }

        NAO_BUTTON.addEventListener('mouseover', moveNaoButton);
        NAO_BUTTON.addEventListener('click', moveNaoButton); 

        // Fun√ß√£o para abrir o WhatsApp com mensagem pr√©-definida
        function openWhatsAppMessage() {
            const phoneNumber = "5519984121959"; // N√∫mero de telefone com DDI/DDD
            // A mensagem √© codificada para URL. Use \n para quebras de linha.
            const message = encodeURIComponent("Eu disse SIM! ü•∞\nQuero meu beijinho, mo!ü•π‚ù§Ô∏è"); 
            
            const whatsappUrl = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${message}`;

            window.open(whatsappUrl, '_blank');
        }
        
        // Listener para o bot√£o √öLTIMO PASSO
        FINAL_WHATSAPP_BTN.addEventListener('click', openWhatsAppMessage);


        SIM_BUTTON.addEventListener('click', () => {
            naoButtonCanMove = false; 
            
            NAO_BUTTON.style.display = 'none';
            SIM_BUTTON.style.display = 'none';
            
            document.getElementById('final-question').style.display = 'none';
            FINAL_BUTTONS_WRAPPER.style.display = 'none'; 
            
            SIM_FINAL_MESSAGE.style.display = 'block';
            FINAL_WHATSAPP_BTN.style.display = 'block'; // Mostra o novo bot√£o!
            
            // Para o efeito de "boom"
            clearInterval(particleInterval);
            HEART_BG.querySelectorAll('.particle').forEach(p => p.remove());
            document.documentElement.style.setProperty('--current-heart-color', 'var(--color-primary)');
            for (let i = 0; i < 50; i++) {
                createParticle();
            }
            particleInterval = setInterval(createParticle, 100);
        });

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            // Garante que apenas o primeiro slide esteja vis√≠vel no carregamento
            CAROUSEL_ITEMS.forEach((item, index) => {
                if (index !== 0) {
                    item.style.display = 'none';
                }
            });

            HEART_BG.style.visibility = 'visible'; 
            startParticleAnimation();
            
            showItem(currentIndex); 
        });
    </script>
</body>
</html>



